language: python
sudo: required
matrix:
  include:
  - os: linux
    dist: trusty
    python: 2.7
    env:
    - PYTHON_MAJOR_VERSION=2.7
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - git
        - libcurl4-openssl-dev
        - unzip
        - gcc-4.8
        - g++-4.8
        - cmake
        - gfortran
        - pandoc
  - os: linux
    dist: trusty
    python: 3.4
    env:
    - PYTHON_MAJOR_VERSION=3.4
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - git
        - libcurl4-openssl-dev
        - unzip
        - gcc-4.8
        - g++-4.8
        - cmake
        - gfortran
        - pandoc
        - python3-pip
  - os: linux
    dist: trusty
    python: 3.5
    env:
    - PYTHON_MAJOR_VERSION=3.5
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - git
        - libcurl4-openssl-dev
        - unzip
        - gcc-4.8
        - g++-4.8
        - cmake
        - gfortran
        - pandoc
        - python3-pip
  - os: linux
    dist: trusty
    python: 3.6
    env:
    - PYTHON_MAJOR_VERSION=3.6
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - git
        - libcurl4-openssl-dev
        - unzip
        - gcc-4.8
        - g++-4.8
        - cmake
        - gfortran
        - pandoc
        - python3-pip
  - os: osx
    osx_image: xcode8.2
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=2.7
  - os: osx
    osx_image: xcode8.2
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.4
  - os: osx
    osx_image: xcode8.2
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.5
  - os: osx
    osx_image: xcode8.2
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.6
  - os: osx
    osx_image: xcode8
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=2.7
  - os: osx
    osx_image: xcode8
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.4
  - os: osx
    osx_image: xcode8
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.5
  - os: osx
    osx_image: xcode8
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.6
  - os: osx
    osx_image: xcode6.4
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=2.7
  - os: osx
    osx_image: xcode6.4
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.4
  - os: osx
    osx_image: xcode6.4
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.5
  - os: osx
    osx_image: xcode6.4
    language: generic
    env:
    - PYTHON_MAJOR_VERSION=3.6
before_install: |
  if [[ $TRAVIS_OS_NAME == 'osx' ]]; then
      rvm get head --auto-dotfiles
      brew update;
      PYTHON_VERSION=$(pyenv install --list | grep "^$PYTHON_MAJOR_VERSION")
      pyenv install -s $PYTHON_VERSION
      pyenv global $PYTHON_VERSION
      # protoc
      pushd /tmp
      wget https://github.com/google/protobuf/releases/download/v3.1.0/protoc-3.1.0-osx-x86_64.zip
      unzip protoc-3.1.0-osx-x86_64.zip
      popd
      export PATH=/tmp/bin:$PATH
      # bazel
      brew install bazel
  fi
  if [[ $TRAVIS_OS_NAME == 'linux' ]]; then
      # protoc
      pushd /tmp
      wget https://github.com/google/protobuf/releases/download/v3.1.0/protoc-3.1.0-linux-x86_64.zip
      unzip protoc-3.1.0-linux-x86_64.zip
      popd
      export PATH=/tmp/bin:$PATH
      # bazel
      wget https://github.com/bazelbuild/bazel/releases/download/0.4.4/bazel_0.4.4-linux-x86_64.deb
      sudo dpkg -i bazel_0.4.4-linux-x86_64.deb
  fi
install:
- pip install -U pip setuptools wheel protobuf numpy
script:
- source travis_installer.sh
- ls
deploy:
  provider: pypi
  user: zihaolucky
  password:
    secure: 28LnL+SqU+PA+eOxKciWo3x6JGoEmuxiUGamIEh+tuFZnUs6YIg2ysnjWOND8DiQhcvA3YhSya7fxBLwyKZGWqwHb4vqqD1tJGhSSOHxSX9kg2xcFu7o0VfVFh0K9C7hY1JE12fCWNN6uSN3Hb3colKW8OkNG06yXg4P+hc+aGfq4y6RntRB6hPvH+eeVrzciRXhWQJEEH3vOWzF4I3EB5aQMNFOXAbKDkjHoGkYtCbUO3eiaP+aF3Mr8mkNxMNZC2aCRylTsgm+dxCHQ7bAQWpUwLQ4YVPC96oF2ConNPK0IoklsTLRjvoWRseLMjqOOZcZW7o4XUJJ7VU3PRazmQEzrWz6ORY2z4YifXxtmZTK7COEp//lRfKsRPmbUpJHf6621ExAMiX3xV2VuiKePc9wN34kfS7ntLMII9/MZJCj70jcqIggBHou3I1a2g54yxSevH9qjkJJreBhfph51h9POJavKQYg6heXn6kxkejpeGcT0RZIIK7QA1cVgdcLhjTRPkNEAV5CUrg55YEH87zC3ZCEtGwDvfJVOVYvirJbW6AD75bCJ10sz5k0rV53WrjyX3JfOm/d8zXrQvXbcH0N8C1bNZIv9aPiIhBrzPVbFkfRE9kJaVdSfu9Z0dS4H4+P578BRbug/2TOiYpng1AC1/Nl367Zl0IEw3n5wgo=
  distributions: bdist_wheel
  on:
    tags: true
  skip_cleanup: true